<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur Rando (Upload Int√©gr√©)</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    
    <style>
        body { overflow: auto; background: #f8fafc; padding: 40px 20px; font-family: 'Nunito Sans', sans-serif; }
        .admin-container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { text-align: center; margin-bottom: 30px; font-size: 2rem; color: #0f172a; }
        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: #0f172a; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; font-family: inherit; font-size: 1rem; }
        textarea { height: 120px; resize: vertical; }
        
        /* Boutons d'upload */
        .upload-btn {
            background: #3b82f6; color: white; border: none; padding: 12px 20px; border-radius: 12px; 
            font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: 0.2s;
        }
        .upload-btn:hover { background: #2563eb; transform: translateY(-2px); }
        .upload-btn.gpx-btn { background: #10b981; } /* Vert pour GPX */

        /* Aper√ßu des fichiers */
        .preview-area { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
        .thumb-box { position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .gpx-status { margin-top: 10px; font-weight: bold; color: #10b981; display: none; }

        .btn-generate { background: #f97316; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-weight: 800; cursor: pointer; width: 100%; font-size: 1.1rem; margin-top: 30px; transition: 0.3s; }
        .btn-generate:hover { background: #ea580c; transform: translateY(-2px); }

        #result-area { margin-top: 40px; display: none; background: #1e293b; padding: 20px; border-radius: 16px; color: #cbd5e1; position: relative; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 0.9rem; }
        .btn-copy { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.1); color: white; border: none; padding: 5px 15px; border-radius: 8px; cursor: pointer; }
        .btn-github { display: block; text-align: center; background: #24292e; color: white; text-decoration: none; padding: 15px; border-radius: 12px; font-weight: 700; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="admin-container">
        <h1>üõ†Ô∏è Ajouter une Rando</h1>
        
        <div class="form-group">
            <label>Titre de la sortie</label>
            <input type="text" id="title" placeholder="Ex: Mont Blanc du Tacul">
        </div>

        <div class="form-group">
            <label>Difficult√©</label>
            <select id="difficulty">
                <option value="Facile">Facile (Vert)</option>
                <option value="Moyenne" selected>Moyenne (Orange)</option>
                <option value="Difficile">Difficile (Rouge)</option>
                <option value="Expert">Expert (Noir)</option>
            </select>
        </div>

        <div class="form-group">
            <label>Description</label>
            <textarea id="desc" placeholder="Raconte ton aventure ici... (Tu peux utiliser du Markdown)"></textarea>
        </div>

        <div class="form-group">
            <label>Fichier GPX</label>
            <button class="upload-btn gpx-btn" onclick="openWidget('gpx')">üìÇ Uploader le fichier GPX</button>
            <div id="gpx-status" class="gpx-status">‚úÖ GPX charg√© : <span id="gpx-name"></span></div>
            <input type="hidden" id="gpx-url"> </div>

        <div class="form-group">
            <label>Photos (Galerie)</label>
            <button class="upload-btn" onclick="openWidget('image')">üì∏ Ajouter des Photos</button>
            <div id="photos-preview" class="preview-area"></div>
        </div>

        <button class="btn-generate" onclick="genererJSON()">G√âN√âRER LE CODE JSON</button>

        <div id="result-area">
            <h3>Code √† copier :</h3>
            <button class="btn-copy" onclick="copierCode()">Copier</button>
            <pre id="json-output"></pre>
            
            <a href="https://github.com/PSEUDO/NOM-DU-PROJET/edit/main/randos.json" target="_blank" class="btn-github">
                Ouvrir randos.json sur GitHub ‚ûî
            </a>
        </div>
    </div>

    <script>
        // --- CONFIGURATION CLOUDINARY ---
        const cloudName = "dkbulsjyo"; 
        const uploadPreset = "ethan_upload"; // <--- REMPLACE PAR TON PRESET "UNSIGNED" CR√â√â √âTAPE 1
        // --------------------------------

        let uploadedPhotos = []; // Stocke les URLs des photos

        function openWidget(type) {
            let options = {
                cloudName: cloudName,
                uploadPreset: uploadPreset,
                sources: ['local', 'url', 'camera'],
                multiple: type === 'image', // Multiple photos OK, mais 1 seul GPX √† la fois
                clientAllowedFormats: type === 'image' ? ['png', 'jpg', 'jpeg', 'webp'] : ['gpx', 'xml'],
                maxFileSize: 10000000 // 10MB
            };

            cloudinary.openUploadWidget(options, (error, result) => {
                if (!error && result && result.event === "success") {
                    console.log('Upload termin√© ! ', result.info);
                    
                    if (type === 'image') {
                        // Ajouter la photo √† la liste et √† l'aper√ßu
                        uploadedPhotos.push({ image: result.info.secure_url });
                        afficherApercu(result.info.secure_url);
                    } else {
                        // Stocker l'URL du GPX
                        document.getElementById('gpx-url').value = result.info.secure_url;
                        document.getElementById('gpx-status').style.display = 'block';
                        document.getElementById('gpx-name').innerText = result.info.original_filename + '.' + result.info.format;
                    }
                }
            });
        }

        function afficherApercu(url) {
            const div = document.createElement('div');
            div.className = 'thumb-box';
            div.innerHTML = `<img src="${url}">`;
            document.getElementById('photos-preview').appendChild(div);
        }

        function genererJSON() {
            const title = document.getElementById('title').value;
            const diff = document.getElementById('difficulty').value;
            const desc = document.getElementById('desc').value;
            const gpx = document.getElementById('gpx-url').value;

            if (!title) { alert("Il faut au moins un titre !"); return; }
            if (!gpx) { alert("N'oublie pas d'uploader le GPX !"); return; }

            // Cr√©ation de l'objet JSON
            const newRando = {
                "title": title,
                "description": desc,
                "difficulty": diff,
                "gpx": gpx,
                "photos": uploadedPhotos // Utilise la liste remplie par le widget
            };

            // Formatage propre
            const jsonString = "    ,\n" + JSON.stringify(newRando, null, 4);

            document.getElementById('json-output').textContent = jsonString;
            document.getElementById('result-area').style.display = 'block';
        }

        function copierCode() {
            const code = document.getElementById('json-output').textContent;
            navigator.clipboard.writeText(code);
            alert("Code JSON copi√© !");
        }
    </script>
</body>
</html>